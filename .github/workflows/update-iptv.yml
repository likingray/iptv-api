# 工作流名称，可自定义，仅用于识别
name: 每周五6点自动更新IPTV直播源

# 触发规则：定时执行 + 手动执行
on:
  schedule:
    # UTC周四22:00 = 北京时间周五6:00，核心定时规则
    - cron: "0 22 * * 4"
  # 允许手动点击运行，方便测试
  workflow_dispatch:

# 执行任务
jobs:
  update-source:
    # 运行环境：GitHub免费提供的Ubuntu最新系统
    runs-on: ubuntu-latest
    steps:
      # 步骤1：将你的仓库代码拉取到执行环境
      - name: 检出仓库代码
        uses: actions/checkout@v4
        with:
          # 拉取完整代码，支持提交修改
          fetch-depth: 0
          # 允许后续步骤推送代码
          persist-credentials: true

      # 步骤2：配置Python环境（该项目基于Python运行）
      - name: 设置Python环境
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 步骤3：安装项目依赖
      - name: 安装依赖库
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 步骤4：执行脚本，生成最新直播源
      - name: 运行更新脚本
        run: python main.py

      # 步骤5：将更新后的文件提交并推送到仓库
      - name: 提交并推送更新
        uses: EndBug/add-and-commit@v9
        with:
          # 提交信息，可自定义
          message: "GitHub Actions 自动更新直播源"
          # 提交所有修改的文件
          add: "."
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
